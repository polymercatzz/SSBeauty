<!DOCTYPE html>
<html lang="th"></html>
<head>
  <meta charset="UTF-8">
  <title>SSBeauty ตารางงาน</title>
  <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-50 min-h-screen m-0">
    <%- include('header_emp') %>
    
    <!-- Main Content -->
    <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
        <!-- Page Header with Filter and Summary -->
        <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-900 mb-1">ตารางงาน</h1>
            <p class="text-sm text-gray-600">รายการนัดหมายและตารางการทำงาน</p>
        </div>

        <!-- Filter and Summary Row -->
        <div class="flex flex-col lg:flex-row gap-4 mb-6">
            <!-- Filter Panel -->
            <div class="flex-1 bg-white shadow-sm rounded-lg border border-gray-200 p-4">
                <div class="flex flex-wrap items-end gap-4">
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-medium text-gray-700 mb-2">เดือน</label>
                        <select id="month-filter" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base focus:ring-2 focus:ring-[#A5848F] focus:border-transparent">
                            <option value="all">ทั้งหมด</option>
                            <option value="jan">มกราคม</option>
                            <option value="feb">กุมภาพันธ์</option>
                            <option value="mar">มีนาคม</option>
                            <option value="apr">เมษายน</option>
                            <option value="may">พฤษภาคม</option>
                            <option value="jun">มิถุนายน</option>
                            <option value="jul">กรกฎาคม</option>
                            <option value="aug">สิงหาคม</option>
                            <option value="sep">กันยายน</option>
                            <option value="oct">ตุลาคม</option>
                            <option value="nov">พฤศจิกายน</option>
                            <option value="dec">ธันวาคม</option>
                        </select>
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-medium text-gray-700 mb-2">วัน</label>
                        <select id="week-filter" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base focus:ring-2 focus:ring-[#A5848F] focus:border-transparent">
                            <option value="all">ทั้งหมด</option>
                            <option value="mon">จันทร์</option>
                            <option value="tue">อังคาร</option>
                            <option value="wed">พุธ</option>
                            <option value="thu">พฤหัสบดี</option>
                            <option value="fri">ศุกร์</option>
                            <option value="sat">เสาร์</option>
                            <option value="sun">อาทิตย์</option>
                        </select>
                    </div>
                    <button onclick="filterSchedule()" class="bg-[#A5848F] hover:bg-[#8a6f77] text-white px-6 py-2.5 rounded-lg font-medium transition-colors shadow-sm text-base">
                        ค้นหา
                    </button>
                </div>
            </div>

            <!-- Summary Card -->
            <div class="lg:w-64">
                <div class="bg-white shadow-sm rounded-lg border border-gray-200 p-5">
                    <p class="text-sm font-medium text-gray-600 mb-3">สรุปรายได้</p>
                    <p class="text-2xl font-bold text-[#A5848F]">2,000 บาท</p>
                </div>
            </div>
        </div>

        <!-- Appointments List -->
        <div class="space-y-3">
            <% appointments.forEach((appointment, index) => { %>
                <% date = new Date(appointment.appointment_date) 
                    const hours = date.getHours();
                    const minutes = date.getMinutes();
                    const formattedHours = hours < 10 ? '0' + hours : hours;
                    const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
                    const hhmm = `${formattedHours}:${formattedMinutes}`;
                %>
                <div class="job bg-white shadow-sm hover:shadow-md transition-shadow rounded-lg p-4 border border-gray-200 cursor-pointer group" 
                    onclick="openPopup(<%= index %>)" data-month="" data-week="">
                    <div class="space-y-3">
                        <!-- Date and Time -->
                        <div class="flex items-center gap-3">
                            <div class="bg-[#ECCF7E] text-white rounded-lg px-3 py-1.5 text-sm font-medium">
                                <%= date.toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit', year: 'numeric' }) %>
                            </div>
                            <span class="text-gray-700 text-base font-medium"><%= hhmm %> น.</span>
                        </div>

                        <!-- Appointment Details -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">รายการ</label>
                                <input type="text" value="<%= appointment.Service.name %>" readonly
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-base bg-gray-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ผู้ใช้บริการ</label>
                                <input type="text" value="<%= appointment.staff_id %>" readonly
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-base bg-gray-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ผลการให้บริการ</label>
                                <input type="text" value="<%= appointment.showstatus %>" readonly
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-base bg-gray-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">รายได้</label>
                                <input type="text" value="" readonly
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-base bg-gray-50">
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </main>

    <!-- Popupprofile -->
    <div id="popuppro" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center">
        <div class="h-10 bg-gray-100"></div>
        <div class="bg-[#F2F1EB] rounded-xl shadow-lg w-[600px] p-6 relative">
            <!-- ปุ่มปิด -->
            <button class="absolute top-3 right-3 text-gray-500 hover:text-red-500" onclick="closePopupprofile()">✖</button>
      
            <h2 class="text-lg font-bold mb-4">ข้อมูลพนังงาน</h2>
      
            <div class="space-y-2 text-sm  p-3 rounded-lg">
                <div class="flex">
                    <div class="flex">
                        <label class="block text-gray-600 p-1"><b>ชื่อ:</b></label>
                        <input type="text" value="" class="w-full border rounded-lg px-3 py-1" >
                    </div >
                    <div class="flex">
                        <label class="block text-gray-600 p-1"><b>ชื่อเล่น:</b></label>
                        <input type="text" value="" class="w-20 border rounded-lg px-3 py-1" >
                    </div>
                </div>
                <div class="flex">
                    <div class="flex">
                        <label class="block text-gray-600 p-1"><b>เบอร์โทร: </b></label>
                        <input type="text" value="" class=" border rounded-lg px-3 py-1" >
                    </div >
                    <div class="flex">
                        <label class="block text-gray-600 p-1"><b>Email: </b></label>
                        <input type="text" value="" class=" border rounded-lg px-3 py-1">
                    </div>
                </div>
                <div class="flex">
                    <div class="flex">
                        <label class="block text-gray-600 p-1"><b>หน้าที่:</b></label>
                        <select class="w-20 border rounded-lg px-3 py-1">
                            <option value="" ></option>
                        </select>
                    </div >
                    <div class="flex">
                        <label class="block text-gray-600 p-1"><b>โปรไฟล์:</b></label>
                        <input type="file" accept="image/*" class=" border rounded-lg px-3 py-1" onchange="previewImage(event)">
                        <img id="preview" class="w-20 h-20 ml-2 hidden" alt="Preview Image">
                    </div>
                </div>
            </div>
            <h3 class="mt-4 font-semibold text-gray-600">สิ่งที่ทำได้:</h3>
            <div class="flex space-x-3">
                <label class="flex items-center ">
                    <input type="checkbox" name="services" value="" class="mr-2"> ตัดผม
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> ย้อมผม
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> ดัดผม
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> ทำสปาผม
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> ไดร์ผม
                </label>
            </div>
            <div class="flex space-x-3">
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> นวดหน้า
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> ทำเล็บ
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> สปามือและเท้า
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> ทำสปาผม
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="services" value="" class="mr-2"> นวดตัว
                </label>
            </div>
            <h3 class="mt-4 font-semibold text-gray-600">แนะนำตัว:</h3>
            <textarea class="w-full max-w-md border rounded-lg px-3 py-2 h-24"></textarea>

            <button class="mt-4 w-full bg-pink-500 hover:bg-pink-600 text-white py-2 rounded-lg">ยืนยัน</button>
        </div>
    </div>

    <!-- Appointment Detail Popup -->
    <div id="popup" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 relative">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-lg flex items-center justify-between">
                <h3 class="text-xl font-semibold text-gray-900">ข้อมูลลูกค้า</h3>
                <button class="text-gray-400 hover:text-gray-600 text-2xl leading-none" onclick="closePopup()">×</button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 space-y-4">
                <!-- Customer Info -->
                <div class="bg-gray-50 rounded-lg p-4 space-y-2 text-base">
                    <div class="flex items-center gap-2">
                        <span class="font-semibold text-gray-900">ชื่อ:</span>
                        <span class="text-gray-700">สมหญิง สมหญิง</span>
                        <span class="font-semibold text-gray-900 ml-4">ชื่อเล่น:</span>
                        <span class="text-gray-700">หญิง</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="font-semibold text-gray-900">เบอร์โทร:</span>
                        <span class="text-gray-700">0000000000</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="font-semibold text-gray-900">Email:</span>
                        <span class="text-gray-700">som@email.com</span>
                    </div>
                </div>

                <!-- Service Details -->
                <div>
                    <h4 class="text-base font-semibold text-gray-900 mb-3">รายละเอียด</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">รายการ</label>
                            <input type="text" value="" readonly
                                class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base bg-gray-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">บริการเสริม</label>
                            <select class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base focus:ring-2 focus:ring-[#A5848F] focus:border-transparent">
                                <option value="">เลือกบริการเสริม</option>
                                <option>มาสก์หน้า</option>
                                <option>นวดคอ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">สถานะการให้บริการ</label>
                            <select class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base focus:ring-2 focus:ring-[#A5848F] focus:border-transparent">
                                <option value="">เลือกสถานะ</option>
                                <option>เสร็จสิ้น</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">รวมค่าใช้จ่าย</label>
                            <div class="flex items-center gap-2">
                                <input type="text" value="" readonly
                                    class="flex-1 border border-gray-300 rounded-lg px-4 py-2.5 text-base bg-gray-50">
                                <span class="text-gray-700 text-base">บาท</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="border-t border-gray-200 px-6 py-4">
                <button class="w-full bg-[#A5848F] hover:bg-[#8a6f77] text-white px-6 py-2.5 rounded-lg font-medium transition-colors shadow-sm text-base">
                    ยืนยัน
                </button>
            </div>
        </div>
    </div>

    <!-- ทำfilter -->
    <script>
        function openPopup() {
            document.getElementById("popup").classList.remove("hidden");
            document.getElementById("popup").classList.add("flex");
        }
        function closePopup() {
            document.getElementById("popup").classList.add("hidden");
        }
        function openPopupprofile(){
            document.getElementById("popuppro").classList.remove("hidden");
            document.getElementById("popuppro").classList.add("flex");
        }
        function closePopupprofile() {
            document.getElementById("popuppro").classList.add("hidden");
        }
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('preview');
                preview.src = e.target.result;
                preview.classList.remove('hidden');
            }
            reader.readAsDataURL(file);
            }
        }
        //filter
        function filterSchedule() {
            const selectedMonth = document.getElementById("month-filter").value;
            const selectedWeek = document.getElementById("week-filter").value;
            const jobs = document.querySelectorAll(".job");

            jobs.forEach(job => {
                const jobMonth = job.dataset.month;
                const jobWeek = job.dataset.week;

                const matchMonth = selectedMonth === "all" || jobMonth === selectedMonth;
                const matchWeek = selectedWeek === "all" || jobWeek === selectedWeek;

                job.style.display = (matchMonth && matchWeek) ? "flex" : "none";
            });
        }

    </script>
</body>
</html>