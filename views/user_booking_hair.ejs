<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home</title>
  <!-- <link rel="stylesheet" href="./dist/output.css" /> -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tangerine:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Kapakana:wght@300..400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Caslon+Display&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <!-- font -->
  <!-- manu -->
  <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
</head>

<body class="bg-gradient-to-t from-[#F2F1EB] to-[#DBB3C1] h-screen bg-fixed bg-cover bg-center min-h-screen">

  <!--  start navbar -->
  <%- include('nav_user', {activePage: 'hair'}) %>

  <!-- <header
    class="bg-gradient-to-r from-[#DBB3C1] to-[#A5848F] max-w-[93%] mx-auto rounded-3xl shadow-lg shadow-black-200 my-2 font-bold fixed w-full z-50 top-5 left-1/2 -translate-x-1/2 z-50">
    <nav class="font-[tangerine] p-[0.5vh] flex justify-between items-center">
      <div class="flex items-center">
        <img src="/img/curl.png" alt="#" class="w-[5vh] m-2">
        <span class="text-[#E5408E] text-[4.5vh] align-middle ml-2">SSBeauty</span>
      </div>
      <div class="flex items-center gap-5">
        <div
          class="nav md:static md:minh-fit md:bg-transparent  absolute bg-white rounded-3xl right-[1%] top-[-1000%] p-3 ">
          <ul
            class="flex md:flex-row flex-col items-center md:gap-5 gap-2 text-[3.7vh] md:text-[4.2vh] md:text-white text-[#E5408E]">
            <li>
              <a href="" class="p-2 md:bg-white md:text-[#E5408E] md:rounded-xl hover:bg-pink-100 rounded-xl ">Hair</a>
            </li>
            <li>
              <a href=""
                class="p-2 md:hover:bg-white md:hover:text-[#E5408E] md:rounded-xl hover:bg-pink-100 rounded-xl">Spa</a>
            </li>
            <li>
              <a href=""
                class="p-2 md:hover:bg-white md:hover:text-[#E5408E] md:rounded-xl hover:bg-pink-100 rounded-xl">History</a>
            </li>
            <li>
              <a href="" class="p-2 md:hover:bg-white text-[#E5408E] md:rounded-xl bg-pink-100 rounded-xl">Logout</a>
            </li>
          </ul>
        </div>
        <div class="flex items-center">
          <a href="">
            <img src="/img/profile.png" alt="" class="w-[5vh] mr-2">
          </a>
          <ion-icon onclick="menuToggle(this)" name="menu"
            class="text-3xl cursor-pointer md:hidden text-white"></ion-icon>
        </div>
      </div>
    </nav>
  </header> -->
  <!--  end navbar -->

  <!--  -->
  <div class="md:pt-[15vh] pt-[13vh]">
    <div class="max-w-[93%] h-[8vh] mx-auto rounded-3xl shadow-lg shadow-black-200 md:my-3 
               bg-white/60 backdrop-blur-md flex items-center justify-start gap-5 p-5">
      <p class="font-[inter] text-[#616162] text-[3vh]">Tensonez</p>
    </div>

<div class="max-w-[93%] mx-auto mt-[5vh] flex flex-col xl:flex-row gap-6">
  <!-- ส่วนรูป -->
  <div class="flex-1 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-4">
    <!-- รูปใหญ่ -->
    <div class="md:col-span-2">
      <img
        src="<%= service.image1_url || '/img/default_service.jpg' %>"
        alt=""
        class="w-full h-full object-cover rounded-xl">
    </div>

    <!-- รูปเล็ก 2 รูป -->
    <div class="flex flex-col gap-4">
      <img 
        src="<%= service.image2_url || '/img/default_service.jpg' %>"
        alt=""
        class="w-full h-[50%] object-cover rounded-xl">
      <img
        src="<%= service.image3_url || '/img/default_service.jpg' %>"
        alt=""
        class="w-full h-[50%] object-cover rounded-xl">
    </div>
  </div>

  <!-- ส่วน description -->
  <div class="flex-1 w-full">
    <p class="font-[tangerine] text-[#E5408E] text-[5vh] font-bold mb-3">Description</p>

    <div class="w-full rounded-3xl shadow-lg bg-white/60 backdrop-blur-md flex flex-col items-start p-5">
      <p class="font-[kanit] text-[#616162] text-[2.5vh] font-light"><%= service.description %>
      </p>
    </div>

    <div
      class="w-full rounded-3xl shadow-lg bg-white/60 backdrop-blur-md flex flex-col items-start p-5 mt-5">
      <div class="flex flex-wrap gap-6 justify-center items-center w-full">
        <div class="flex items-center gap-2 font-[inter] text-[#616162] text-[2.5vh]">
          <img src="/img/shopping-cart.png" alt="" class="w-[2.5vh]">
          <p><%= service.name %></p>
        </div>
        <div class="flex items-center gap-2 font-[kanit] text-[#616162] text-[2.5vh]">
          <img src="/img/pending.png" alt="" class="w-[2.5vh]">
          <p><%= service.duration %> นาที</p>
        </div>
        <div class="flex items-center gap-2 font-[kanit] text-[#616162] text-[2.5vh]">
          <img src="/img/usd-circle.png" alt="" class="w-[2.5vh]">
          <p><%= service.price %> บาท</p>
        </div>
      </div>
    </div>

    <% if (service.Employees && service.Employees.length > 0) { %>
      <button id="openModalBtn"
        class="bg-gradient-to-r from-[#DBB3C1] to-[#A5848F] text-white font-[kanit] text-[3vh] px-10 py-2 rounded-3xl shadow-lg hover:scale-105 transition-transform duration-300 mt-5 w-full">
        Book Now
      </button>
    <% } else { %>
      <button disabled
        class="bg-gray-400 text-white font-[kanit] text-[3vh] px-10 py-2 rounded-3xl shadow-lg cursor-not-allowed mt-5 w-full">
        ไม่มีช่างให้บริการ
      </button>
    <% } %>
  </div>
</div>


<!-- popup booking -->
     <!-- Modal Background + Overlay -->
    <div id="bookingModal" class="fixed inset-0 bg-white/60 backdrop-blur-sm hidden justify-center items-center z-50">

        <!-- Modal Content -->
        <div class="bg-[#F9F7F6] w-[90%] max-w-[500px] rounded-xl shadow-lg relative p-6 animate-fadeIn">
            <!-- ปุ่มปิด -->
            <button id="closeModalBtn"
                class="absolute top-3 right-3 text-white bg-[#A5848F] hover:bg-[#8a6f77] rounded-full w-8 h-8 flex items-center justify-center">
                ✕
            </button>

            <!-- ฟอร์ม -->
            <form id="bookingForm" class="space-y-6 mt-10 text-[2vh]" action="/user/booking/<%= service.service_id %>" method="POST">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block font-[kanit] text-gray-700 mb-1">วันที่:</label>
                  <input type="date" id="dateInput" name="appointment_date"
                    class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-[#DBB3C1] outline-none" required>
                </div>
                <div>
                  <label class="block font-[kanit] text-gray-700 mb-1">เวลา:</label>
                  <input type="time" id="timeInput" name="appointment_time"
                    class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-[#DBB3C1] outline-none" required>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block font-[kanit] text-gray-700 mb-1">บริการ:</label>
                  <input type="text" value="Hair" readonly name="type"
                    class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-[#DBB3C1] outline-none">
                </div>
                <div class="relative w-full">
                  <!-- ปุ่มเปิด dropdown -->
                  <label class="block font-[kanit] text-gray-700 mb-1">บริการเสริม:</label>

                  <button id="dropdownBtn" type="button"
                    class="w-full border rounded-lg p-2 flex justify-between items-center focus:ring-2 focus:ring-[#DBB3C1]">
                    <span id="dropdownText" class="text-gray-600">เลือกบริการเสริม</span>
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>

                  <!-- รายการ dropdown -->
                  <div id="dropdownMenu"
                    class="absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg hidden max-h-40 overflow-y-auto">
                    <label class="flex items-center p-2 gap-2 cursor-pointer hover:bg-gray-100">
                      <input type="checkbox" name="extra" value="สครับหน้า" data-cost="200" class="w-4 h-4 text-[#A5848F]">
                      <span>สครับหน้า (200฿)</span>
                    </label>
                    <label class="flex items-center p-2 gap-2 cursor-pointer hover:bg-gray-100">
                      <input type="checkbox" name="extra" value="นวดคอ" data-cost="150" class="w-4 h-4 text-[#A5848F]">
                      <span>นวดคอ (150฿)</span>
                    </label>
                    <label class="flex items-center p-2 gap-2 cursor-pointer hover:bg-gray-100">
                      <input type="checkbox" name="extra" value="นวดไหล่" data-cost="150" class="w-4 h-4 text-[#A5848F]">
                      <span>นวดไหล่ (150฿)</span>
                    </label>
                    <label class="flex items-center p-2 gap-2 cursor-pointer hover:bg-gray-100">
                      <input type="checkbox" name="extra" value="นวดเท้า" data-cost="180" class="w-4 h-4 text-[#A5848F]">
                      <span>นวดเท้า (180฿)</span>
                    </label>
                  </div>
                </div>
              </div>

              <div>
                <label class="block font-[kanit] text-gray-700 mb-1">ช่าง:</label>
                <% if (service.Employees && service.Employees.length > 0) { %>
                  <select id="employeeSelect" name="employee" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-[#DBB3C1] outline-none" required>
                    <option value="">-- เลือก --</option>
                    <% service.Employees.forEach(employee => { %>
                      <option value="<%= employee.employee_id %>">ช่าง <%= employee.User.first_name %> <%= employee.User.last_name %></option>
                    <% }); %>
                  </select>
                <% } else { %>
                  <div class="w-full border rounded-lg p-2 bg-gray-100 text-gray-500">
                    ไม่มีช่างให้บริการในขณะนี้
                  </div>
                <% } %>
              </div>
              <!-- ปุ่มยืนยัน -->
              <% if (service.Employees && service.Employees.length > 0) { %>
                <button type="submit"
                  class="bg-[#A5848F] text-white font-[kanit] w-fit px-6 py-2 rounded-lg hover:bg-[#8a6f77] transition block mx-auto">
                  ยืนยันการจอง
                </button>
              <% } else { %>
                <button type="button" disabled
                  class="bg-gray-400 text-white font-[kanit] w-fit px-6 py-2 rounded-lg cursor-not-allowed block mx-auto">
                  ไม่สามารถจองได้
                </button>
              <% } %>
            </form>
        </div>
    </div>



  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
  document.getElementById('bookingForm').addEventListener('submit', function(e) {
              const dateInput = document.getElementById('dateInput');
              const timeInput = document.getElementById('timeInput');
              const employeeSelect = document.getElementById('employeeSelect');

              const dateVal = dateInput.value;
              const timeVal = timeInput.value;
              const employeeVal = employeeSelect.value;
              console.log(employeeVal);
              if (!dateVal) {
                alert('กรุณาเลือกวันที่');
                dateInput.focus();
                e.preventDefault();
                return;
              }
              if (!timeVal) {
                alert('กรุณาเลือกเวลา');
                timeInput.focus();
                e.preventDefault();
                return;
              }
              if (!employeeVal) {
                alert('กรุณาเลือกช่าง');
                employeeSelect.focus();
                e.preventDefault();
                return;
              }

              // ตรวจสอบวันและเวลาไม่ย้อนหลัง
              const selectedDateTime = new Date(dateVal + 'T' + timeVal);
              const now = new Date();
              if (selectedDateTime < now) {
                alert('วันและเวลาต้องไม่ย้อนหลัง');
                dateInput.focus();
                e.preventDefault();
                return;
              }

              // Collect selected extras (name + cost) and append as hidden input
              const selectedExtras = Array.from(document.querySelectorAll('#dropdownMenu input[type="checkbox"]:checked'))
                .map(cb => ({ name: cb.value, cost: parseFloat(cb.dataset.cost) || 0 }));

              // Remove existing hidden extras input if present
              const existing = document.querySelector('input[name="extras"]');
              if (existing) existing.remove();

              if (selectedExtras.length > 0) {
                const hidden = document.createElement('input');
                hidden.type = 'hidden';
                hidden.name = 'extras';
                hidden.value = JSON.stringify(selectedExtras);
                this.appendChild(hidden);
              }
            });
  </script>
  <script>
    // nav manu
    const nav = document.querySelector('.nav');
    function menuToggle(e) {
      e.name = e.name === 'menu' ? 'close' : 'menu';
      nav.classList.toggle('top-[110%]');
      nav.classList.toggle('top-[-1000%]');
    }

    // dropdown        
        const modal = document.getElementById("bookingModal");
        const openBtn = document.getElementById("openModalBtn");
        const closeBtn = document.getElementById("closeModalBtn");

        openBtn.addEventListener("click", () => {
            modal.classList.remove("hidden");
            modal.classList.add("flex");
        });

        closeBtn.addEventListener("click", () => {
            modal.classList.add("hidden");
        });

        // ปิด modal ถ้าคลิกนอกกล่อง
        window.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.classList.add("hidden");
            }
        });

        const dropdownBtn = document.getElementById("dropdownBtn");
        const dropdownMenu = document.getElementById("dropdownMenu");
        const dropdownText = document.getElementById("dropdownText");

        // toggle dropdown
        dropdownBtn.addEventListener("click", () => {
            dropdownMenu.classList.toggle("hidden");
        });

        // update text เมื่อเลือก
        const checkboxes = dropdownMenu.querySelectorAll("input[type='checkbox']");
        checkboxes.forEach(cb => {
            cb.addEventListener("change", () => {
                const selected = Array.from(checkboxes)
                    .filter(c => c.checked)
                    .map(c => c.value);

                dropdownText.textContent = selected.length > 0 ? selected.join(", ") : "เลือกบริการเสริม";
            });
        });

        // ปิด dropdown ถ้าคลิกนอก
        window.addEventListener("click", (e) => {
            if (!dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                dropdownMenu.classList.add("hidden");
            }
        });


  </script>
      <!-- Animation -->
    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }
    </style>

</body>

</html>