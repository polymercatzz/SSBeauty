<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>SSBeautyp - emp เบิกสินค้า</title>
    <script src="https://cdn.tailwindcss.com"></script>

</head>

<body class="bg-gray-50 min-h-screen m-0">
    <%- include('header_emp') %>
    
    <!-- Main Content -->
    <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
        <!-- Page Header -->
        <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-900">เบิกสินค้า</h1>
            <p class="text-sm text-gray-600 mt-1">ค้นหาและเบิกสินค้าสำหรับการให้บริการ</p>
        </div>

        <!-- Filter Panel -->
        <div class="bg-white shadow-sm rounded-lg border border-gray-200 p-4 mb-6">
            <div class="flex flex-wrap items-end gap-4">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ค้นหาสินค้า</label>
                    <input type="text" id="search-input" 
                        class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base focus:ring-2 focus:ring-[#A5848F] focus:border-transparent"
                        placeholder="ค้นหาชื่อสินค้า...">
                </div>
                <button id="search-btn" 
                    class="bg-[#A5848F] hover:bg-[#8a6f77] text-white px-6 py-2.5 rounded-lg font-medium transition-colors shadow-sm text-base">
                    ค้นหา
                </button>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4" id="product-grid">
            <% products.forEach(product=> { %>
                <div onclick="openPopup(<%= product.product_id %>)" class="product-item cursor-pointer group">
                    <div class="bg-white shadow-sm hover:shadow-md transition-shadow rounded-lg p-4 border border-gray-200">
                        <div class="text-center mb-3">
                            <img src="<%= product.imageSignedUrl || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22160%22%3E%3Crect fill=%22%23f3f4f6%22 width=%22200%22 height=%22160%22/%3E%3Ctext fill=%22%23A5848F%22 font-family=%22Arial%22 font-size=%2214%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3ENo Image%3C/text%3E%3C/svg%3E' %>" 
                                alt="<%= product.name %>" 
                                class="mx-auto rounded-lg h-40 w-full object-cover"
                                onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22160%22%3E%3Crect fill=%22%23f3f4f6%22 width=%22200%22 height=%22160%22/%3E%3Ctext fill=%22%23A5848F%22 font-family=%22Arial%22 font-size=%2214%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3ENo Image%3C/text%3E%3C/svg%3E'">
                        </div>
                        <div class="space-y-2">
                            <p class="product-name text-base font-semibold text-gray-900"><%= product.name %></p>
                            <p class="text-base text-gray-700">ราคา: <span class="font-medium text-[#A5848F]"><%= product.price %> บาท</span></p>
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-600">คงเหลือ:</span>
                                <% if (product.stock_qty < 10) { %>
                                    <span class="inline-flex items-center bg-red-500 px-2.5 py-1 rounded-lg text-white text-sm font-medium">
                                        <%= product.stock_qty %> <%= product.unit %> (ต่ำ!)
                                    </span>
                                <% } else { %>
                                    <span class="inline-flex items-center bg-[#A5848F] px-2.5 py-1 rounded-lg text-white text-sm font-medium">
                                        <%= product.stock_qty %> <%= product.unit %>
                                    </span>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </main>


    <!-- Product Pickup Popup -->
    <% products.forEach(product=> { %>
        <form action="/employee/use/<%= product.product_id %>" method="POST" 
            id="popup-<%= product.product_id %>" 
            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 relative">
                <!-- Modal Header -->
                <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-lg flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-gray-900">รายละเอียดการเบิก</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                        onclick="closePopup(<%= product.product_id %>)">×</button>
                </div>

                <!-- Modal Body -->
                <div class="p-6 space-y-4">
                    <!-- ผู้เบิก -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ผู้เบิก</label>
                        <input type="text" value="<%= employee.User.first_name %> <%= employee.User.last_name %>" readonly
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base bg-gray-50 text-gray-700" />
                    </div>

                    <!-- ผลิตภัณฑ์ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ผลิตภัณฑ์</label>
                        <input type="text" value="<%= product.name %>" readonly
                            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base bg-gray-50 text-gray-700" />
                    </div>

                    <!-- จำนวน / สำหรับ -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                จำนวน 
                                <span class="text-xs text-gray-500">(สูงสุด: <%= product.stock_qty %>)</span>
                            </label>
                            <input type="number" name="quantity" required min="1" max="<%= product.stock_qty %>"
                                class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base focus:ring-2 focus:ring-[#A5848F] focus:border-transparent"
                                placeholder="0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">สำหรับ</label>
                            <input type="text" name="for_customer"
                                class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-base focus:ring-2 focus:ring-[#A5848F] focus:border-transparent"
                                placeholder="ชื่อลูกค้า">
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="border-t border-gray-200 px-6 py-4 flex gap-3">
                    <button type="button" onclick="closePopup(<%= product.product_id %>)"
                        class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-2.5 rounded-lg font-medium transition-colors text-base">
                        ยกเลิก
                    </button>
                    <button type="submit"
                        class="flex-1 bg-[#A5848F] hover:bg-[#8a6f77] text-white px-6 py-2.5 rounded-lg font-medium transition-colors shadow-sm text-base">
                        ยืนยัน
                    </button>
                </div>
            </div>
        </form>
        <% }); %>



        <!-- ทำfilter -->
        <script>
            function openPopup(productId) {
                document.getElementById(`popup-${productId}`).classList.remove("hidden");
                document.getElementById(`popup-${productId}`).classList.add("flex");
            }
            function closePopup(productId) {
                document.getElementById(`popup-${productId}`).classList.add("hidden");
            }
            function openPopupprofile() {
                document.getElementById("popuppro").classList.remove("hidden");
                document.getElementById("popuppro").classList.add("flex");
            }
            function closePopupprofile() {
                document.getElementById("popuppro").classList.add("hidden");
            }
            //filter
            const searchBtn = document.getElementById("search-btn");
            const searchInput = document.getElementById("search-input");
            const products = document.querySelectorAll(".product-item");

            searchBtn.addEventListener("click", () => {
                const searchText = searchInput.value.toLowerCase();
                products.forEach(product => {
                    const name = product.querySelector(".product-name").textContent.toLowerCase();
                    if (!searchText || name.includes(searchText)) {
                        product.style.display = "block";
                    } else {
                        product.style.display = "none";
                    }
                });
            });
        </script>

        <%- include('emp_profile_popup') %>

</body>

</html>